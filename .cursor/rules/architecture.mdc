---
alwaysApply: true
---

## Custom Skin Plugin Overview

Custom Skin is a multi-platform Minecraft plugin that allows players to use **animated skins** with **any official cape**. Players configure their skin via a web dashboard, and changes sync in real-time to the game server.

### Key Features

1. **Animated Skins**: Upload a PNG with multiple 64x64 frames stacked vertically (up to 16 frames). Other players see the animation; you see the first frame.
2. **Cape Selection**: Choose from any official Minecraft cape (Minecon, Migrator, etc.)
3. **Web Dashboard**: Token-authenticated dashboard - no account creation needed. Get a link in-game, configure your skin in browser.
4. **Real-time Sync**: WebSocket connection between plugin and API ensures instant updates when you save in the dashboard.

### Architecture

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  MC Plugin      │◄───►│  Custom Skin    │◄───►│  Dashboard      │
│  (Bukkit/etc)   │ WS  │  API (Rust)     │ WS  │  (Next.js)      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                       │                       │
        │                       ▼                       │
        │               ┌─────────────────┐             │
        │               │  Supabase DB    │             │
        │               │  + MineSkin API │             │
        │               └─────────────────┘             │
        │                                               │
        └───────── Token auth (JWT) ───────────────────►
```

### Modules

- `customskin-core`: Shared logic, models, API client, WebSocket client.
- `customskin-bukkit`: Bukkit/Paper adapter with packet-based animation.
- `customskin-bungee`: BungeeCord adapter.
- `customskin-velocity`: Velocity adapter.

### How Animation Works

1. Player joins → Plugin fetches skin config from API
2. Apply **frame[0]** to player's actual profile (they see static skin)
3. For each viewer: send `PlayerInfoUpdate` packets with rotating frame textures
4. Viewers see the animation; player sees static first frame

### Token-Based Authentication

No Supabase Auth needed. Flow:
1. Player joins or runs `/skin link`
2. Plugin generates signed JWT with `minecraft_uuid`, `username`, 24h expiry
3. Player gets clickable link: `https://skin.thomas.md/dashboard?token=xxx`
4. Dashboard validates token, shows skin editor
5. On save, WebSocket notifies plugin → instant in-game update

### Build System

- Gradle (Kotlin DSL) with Java toolchain 17.
- Plugins: `com.github.johnrengelman.shadow`, `java`.
- Outputs: `build/libs/customskin-<version>.jar`

### Dependencies

- Core: Gson, Adventure API, SnakeYAML, JWT library, WebSocket client
- Bukkit: Paper API 1.20.4+, Adventure Platform Bukkit, bStats
- BungeeCord: BungeeCord API, Adventure Platform BungeeCord
- Velocity: Velocity API 3.3.0+

### Development Workflow

```bash
# Build
./gradlew build

# Deploy to test server
rsync -avP build/libs/customskin-*.jar user@server:/path/to/plugins/
```
